# Google Analytics 4 (GA4) 설정 가이드

## 📋 설정 완료 체크리스트

### ✅ 완료된 작업
- [x] react-ga4 라이브러리 설치
- [x] 환경 변수 설정 (.env.local)
- [x] GA4 초기화 유틸리티 작성 (client/src/lib/analytics.ts)
- [x] App.tsx에 GA4 초기화 추가
- [x] 페이지 뷰 자동 추적 설정
- [x] 커스텀 이벤트 추가 (게시글 조회, 좋아요, 댓글, 로그인/로그아웃)

### 🔲 남은 작업
- [ ] Google Analytics 계정 생성 및 측정 ID 발급
- [ ] .env.local 파일에 측정 ID 입력
- [ ] 테스트 및 확인

---

## 1️⃣ Google Analytics 계정 생성 및 측정 ID 발급

### 단계별 가이드:

1. **Google Analytics 접속**
   - https://analytics.google.com/ 방문
   - Google 계정으로 로그인

2. **계정 만들기**
   - "측정 시작" 또는 "관리" 클릭
   - "+ 계정 만들기" 클릭
   - 계정 이름: `스파르타 셀러 커뮤니티`
   - "다음" 클릭

3. **속성 만들기**
   - 속성 이름: `스파르타 셀러 웹사이트`
   - 보고 시간대: `대한민국 (GMT+09:00)`
   - 통화: `대한민국 원 (₩)`
   - "다음" 클릭

4. **비즈니스 정보**
   - 업종: "커뮤니티 및 콘텐츠"
   - 비즈니스 규모: 적절한 크기 선택
   - 목표: "사용자 참여도 측정"
   - "만들기" 클릭
   - 서비스 약관 동의

5. **데이터 스트림 설정**
   - 플랫폼: **"웹"** 선택
   - 웹사이트 URL: 배포된 도메인 입력 (예: https://yourdomain.com)
   - 스트림 이름: `스파르타 셀러 웹`
   - "스트림 만들기" 클릭

6. **측정 ID 복사 ⭐**
   - 화면에 표시되는 측정 ID를 복사합니다
   - 형식: `G-XXXXXXXXXX`

---

## 2️⃣ 환경 변수 설정

1. **client/.env.local 파일 열기**

2. **측정 ID 입력**
   ```env
   # Google Analytics 4
   VITE_GA4_MEASUREMENT_ID=G-XXXXXXXXXX
   ```

   ⚠️ `G-XXXXXXXXXX`를 실제 측정 ID로 교체하세요!

3. **개발 서버 재시작**
   ```bash
   npm run dev
   ```

---

## 3️⃣ 테스트 및 확인

### 로컬 테스트 (개발 환경)

1. **브라우저 개발자 도구 열기** (F12)

2. **Console 탭에서 확인**
   - GA4 초기화 메시지 확인:
     ```
     ✅ GA4 초기화 완료: G-XXXXXXXXXX
     ```

   - 페이지 뷰 추적 로그:
     ```
     📊 페이지 뷰 추적: / Home
     ```

   - 이벤트 추적 로그:
     ```
     🎯 이벤트 추적: { category: 'Post', action: 'View', label: '...' }
     ```

3. **GA4 실시간 보고서 확인**
   - Google Analytics 대시보드 열기
   - 왼쪽 메뉴: **보고서 > 실시간**
   - 현재 활성 사용자 수 확인
   - 이벤트 활동 확인

### 배포 환경 테스트

1. **배포 전 .env 파일 확인**
   - Vercel/Netlify 등 배포 플랫폼의 환경 변수 설정
   - `VITE_GA4_MEASUREMENT_ID=G-XXXXXXXXXX` 추가

2. **배포 후 테스트**
   - 실제 사이트 방문
   - GA4 실시간 보고서에서 활동 확인
   - 개발자 도구 Console에는 로그가 표시되지 않음 (프로덕션 모드)

---

## 📊 추적되는 이벤트 목록

### 자동 추적
- ✅ **페이지 뷰**: 모든 페이지 이동 시 자동 추적

### 커스텀 이벤트
- ✅ **게시글 조회** (`Post > View`)
  - 게시글 상세 모달을 열 때
  - label: 게시글 제목

- ✅ **좋아요/좋아요 취소** (`Engagement > Like/Unlike`)
  - 하트 버튼 클릭 시
  - label: 게시글 ID

- ✅ **댓글 작성** (`Engagement > Comment`)
  - 댓글 작성 완료 시
  - label: 게시글 ID

- ✅ **로그인** (`User > Login`)
  - Google 로그인 성공 시
  - label: 'Google'

- ✅ **로그아웃** (`User > Logout`)
  - 로그아웃 버튼 클릭 시

---

## 🔍 Google Analytics에서 데이터 확인하기

### 실시간 보고서
- **경로**: 보고서 > 실시간
- **확인 가능한 정보**:
  - 현재 활성 사용자 수
  - 조회수 (페이지별)
  - 이벤트 활동
  - 사용자 위치

### 이벤트 보고서
- **경로**: 보고서 > 참여도 > 이벤트
- **확인 가능한 정보**:
  - 이벤트별 발생 횟수
  - 이벤트 매개변수
  - 사용자별 이벤트

### 사용자 보고서
- **경로**: 보고서 > 사용자 > 사용자 속성
- **확인 가능한 정보**:
  - 신규/재방문 사용자
  - 인구통계
  - 기술 환경 (브라우저, OS, 기기)

### 페이지 및 화면 보고서
- **경로**: 보고서 > 참여도 > 페이지 및 화면
- **확인 가능한 정보**:
  - 페이지별 조회수
  - 평균 참여 시간
  - 이탈률

---

## 🎯 Today & Total 방문자 수 확인 방법

### GA4 대시보드에서 확인

1. **Today 방문자**
   - **보고서 > 실시간** 에서 "지난 30분간 사용자" 확인
   - 또는 **보고서 > 사용자 > 사용자 속성**에서 날짜 필터를 "오늘"로 설정

2. **Total 방문자**
   - **보고서 > 사용자 > 사용자 속성**
   - 날짜 범위를 "전체 기간"으로 설정
   - "총 사용자" 지표 확인

3. **커스텀 대시보드 만들기**
   - **탐색 > 빈 슬레이트**
   - "측정기준" 추가: 날짜
   - "측정항목" 추가: 활성 사용자
   - 날짜별 방문자 추이 그래프 생성

---

## 🚨 문제 해결

### GA4가 초기화되지 않을 때

1. **.env.local 파일 확인**
   ```env
   VITE_GA4_MEASUREMENT_ID=G-XXXXXXXXXX
   ```
   - 측정 ID가 올바른지 확인
   - `G-XXXXXXXXXX`가 아닌 실제 ID인지 확인

2. **개발 서버 재시작**
   ```bash
   # Ctrl+C로 서버 종료 후
   npm run dev
   ```

3. **브라우저 캐시 삭제**
   - Ctrl+Shift+Delete (크롬)
   - 쿠키 및 사이트 데이터 삭제

### 이벤트가 추적되지 않을 때

1. **개발자 도구 Console 확인**
   - 에러 메시지가 있는지 확인
   - GA4 초기화 메시지가 표시되는지 확인

2. **광고 차단기 비활성화**
   - 일부 광고 차단기가 GA4를 차단할 수 있음
   - 테스트 시 비활성화

3. **실시간 보고서 확인**
   - GA4 대시보드의 실시간 보고서에서 즉시 확인 가능
   - 일반 보고서는 24-48시간 후 반영됨

### 프로덕션에서 데이터가 수집되지 않을 때

1. **배포 환경 변수 확인**
   - Vercel/Netlify 설정에 `VITE_GA4_MEASUREMENT_ID` 추가
   - 빌드 후 재배포

2. **HTTPS 확인**
   - GA4는 HTTPS에서만 정상 작동
   - HTTP는 데이터 수집이 제한될 수 있음

---

## 📝 추가 커스텀 이벤트 추가 방법

새로운 이벤트를 추적하고 싶다면:

```typescript
import { trackEvent } from '@/lib/analytics';

// 예시: 검색 이벤트
trackEvent('Search', 'Submit', searchKeyword);

// 예시: 버튼 클릭 이벤트
trackEvent('Button', 'Click', 'CTA Button');

// 예시: 파일 다운로드 이벤트
trackEvent('Download', 'File', fileName);
```

---

## 🎉 완료!

GA4 설정이 완료되었습니다!

**다음 단계:**
1. Google Analytics 계정 생성
2. 측정 ID를 .env.local에 입력
3. 개발 서버 재시작
4. 실시간 보고서에서 데이터 확인

궁금한 점이 있으면 [Google Analytics 공식 문서](https://support.google.com/analytics)를 참고하세요.
